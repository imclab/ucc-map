// Generated by CoffeeScript 1.6.2
var Arcball, Color, Cube, MathUtils, Mesh, PerspectiveCamera, Scene, Test, Vec3, pex, _ref;

pex = pex || require('./lib/pex');

_ref = pex.scene, Scene = _ref.Scene, PerspectiveCamera = _ref.PerspectiveCamera, Arcball = _ref.Arcball;

Mesh = pex.gl.Mesh;

Vec3 = pex.geom.Vec3;

Cube = pex.geom.gen.Cube;

Test = pex.materials.Test;

Color = pex.color.Color;

MathUtils = pex.utils.MathUtils;

pex.require(['utils/GLX', 'ucc/Layer', 'ucc/LayersController'], function(GLX, Layer, LayersController) {
  return pex.sys.Window.create({
    settings: {
      width: 1280,
      height: 720,
      fullscreen: pex.sys.Platform.isBrowser
    },
    layerDistance: 0.1,
    init: function() {
      var _this = this;

      this.camera = new PerspectiveCamera(60, this.width / this.height, 0.1, 100, new Vec3(0, 1, 0), new Vec3(0, 0, 0), new Vec3(0, 0, -1));
      this.scene = new Scene();
      MathUtils.seed(0);
      this.layers = [
        {
          img: 'assets/satellite.jpg',
          level: -1
        }, {
          img: 'assets/A0-plan.png',
          level: 0
        }, {
          img: 'assets/A1-plan.png',
          level: 1
        }
      ];
      this.layers = this.layers.map(function(layerData) {
        var layer;

        layer = new Layer(layerData.img);
        layer.position = new Vec3(Math.random() * 0.5 - 0.25, -0.02 + layerData.level * _this.layerDistance, Math.random() * 0.5 - 0.25);
        return _this.scene.add(layer);
      });
      this.layersController = new LayersController(this, this.scene, this.camera);
      this.arcball = new Arcball(this, this.camera);
      return this.glx = new GLX(this.gl);
    },
    draw: function() {
      this.glx.enableDepthWriteAndRead(true, true).clearColorAndDepth(Color.Black);
      this.gl.blendFunc(this.gl.ONE_MINUS_SRC_COLOR, this.gl.ONE);
      return this.scene.draw(this.camera);
    }
  });
});
